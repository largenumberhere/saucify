<!--
    Proof of concept for convering a creatures dimensions to/from sauce on a website
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <p>Creature's tallness in cm</p>
        <input type="text" id ="tallness_cm"/>
    </div>
    <div>
        <p>Creature's tallness in sauces</p>
        <input type="text" id="tallness_sauces"/>
    </div>

    <div>
        <p>Creature's tallness in mm</p>
        <input type="text" id="tallness_mm"/>
    </div>
    
    
    <script>
        // global constants
        const sauces_element = document.querySelector("#tallness_sauces");
        const cm_element =  document.querySelector("#tallness_cm");
        const mm_element = document.querySelector("#tallness_mm");
        const input_elements = [sauces_element, cm_element, mm_element]; 
        const input_element_converters = [sauces_to_cm, sauces_to_mm];

        const sauce_to_height_ratio_cm = 5.08;
        const cm_to_mm_ratio = 10; 


        // https://stackoverflow.com/questions/11832914/how-to-round-to-at-most-2-decimal-places-if-necessary
        function round_2_decimal_places(value) {
            return Math.round((value + Number.EPSILON) * 100)  / 100;
        }
        
        // https://stackoverflow.com/questions/175739/how-can-i-check-if-a-string-is-a-valid-number
        function assert_maybe_a_number(value) {
            if (!isNaN(value) && isFinite(value)) {
                return;
            }
            
            throw  `${value} is not a number`;   
        }

        // register handler
        cm_element.addEventListener("keyup", (keyboard_event) => {
            let result;
            const source_element = keyboard_event.srcElement;
            const element_text = source_element.value;

            update_sauces(element_text, cm_to_sauces);
        });

        sauces_element.addEventListener("keyup", (keyboard_event) => {
            const source_element = keyboard_event.srcElement;
            const element_text = source_element.value;
            
            update_cm(element_text, sauces_to_cm);
        });

        /*
            write to the cm field with the formula encapsulated in conversion_fn
            conversion_fn: 
                - is a function which takes in a number and returns a number. 
                  It must convert from the given units to cm
        */
        function update_cm(text, convesion_fn) {
            let result;
            const text_as_number = Number(text);
            assert_maybe_a_number(text_as_number);

            result = convesion_fn(text_as_number);
            result = round_2_decimal_places(result);

            cm_element.value = `${result}`;
        }

        // /*
        //     write to the sauces field with the formula encapsulated in conversion_fn
        //     conversion_fn: 
        //         - is a function which takes in a number and returns a number. 
        //           It must convert from the given units to sauces
        // */
        // function update_sauces(text, conversion_to_sacues_fn) {
        //     let sauces_count;
        //     const text_as_number = Number(text);
        //     assert_maybe_a_number(text_as_number);

        //     sauces_count = conversion_fn(text_as_number);
        //     sauces_count = round_2_decimal_places(result);

        //     sauces_element.value = `${result}`;
            
        // }

        // converters
        function sauces_to_cm(number) {
            return number * sauce_to_height_ratio_cm;
        }

        function sauces_to_mm(number) {
            return number * sauce_to_height_ratio_cm * 10;
        }
        
        // walk through all elements to update them accordingly
        function update_all(text_value, fn_value_to_sauces) {
            // hoisted variables
                let sauces_count;

                // reused in loop later
                let selected_input_element;
                let selected_converter;
                let selected_element_text;
                let selected_element_text_as_number;
                let selected_element_result;
                let selected_next_element;

            // update sauces
            const text_as_number = Number(text_value);

            sauces_count = conversion_fn(text_as_number);
            sauces_count = round_2_decimal_places(result);

            sauces_element.value = `${sauces_count}`;

            // update the rest
            for (let i = 0; i < input_element_converters.length; i++) {
                // get the iteration's things
                selected_input_element = input_elements[i];
                selected_converter = input_element_converters[i];
                selected_next_element = input_elements[i+1];

                // get the text
                selected_element_text = selected_input_element.value;
                
                // convert the text to number
                selected_element_text_as_number = Number(selected_element_text);
                assert_maybe_a_number(selected_element_text_as_number);
                
                // convert the number to a different number
                selected_element_result = selected_converter(selected_element_text_as_number);
                
                // write to the next box
                selected_next_element.value = `${selected_element_result}`;
            }
        }

        // set defaults
        // set_tallness(0);

    </script>
    
</body>
</html>